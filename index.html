<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTM 2025-27 - Organizador</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f8fafc;
            color: #1e293b;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .login-box {
            background: white;
            padding: 50px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .login-box h1 {
            font-size: 2em;
            margin-bottom: 10px;
            color: #667eea;
        }

        .login-box p {
            color: #64748b;
            margin-bottom: 30px;
        }

        .login-box select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1em;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .login-box button {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .login-box button:hover {
            background: #5568d3;
        }

        /* Header */
        header {
            background: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .logo {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: #f1f5f9;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .logout-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-tabs button {
            padding: 12px 24px;
            border: none;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1em;
        }

        .nav-tabs button.active {
            background: #667eea;
            color: white;
        }

        .nav-tabs button:not(.active):hover {
            background: #f1f5f9;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .card h3 {
            margin-bottom: 15px;
            color: #1e293b;
        }

        .upcoming-activity {
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .upcoming-activity:last-child {
            margin-bottom: 0;
        }

        .upcoming-activity strong {
            display: block;
            margin-bottom: 5px;
        }

        .upcoming-activity small {
            color: #64748b;
        }

        .area-progress {
            margin-bottom: 15px;
        }

        .area-progress:last-child {
            margin-bottom: 0;
        }

        .area-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .progress-bar {
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.5s;
        }

        /* Calendar */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
        }

        .calendar-header h2 {
            font-size: 1.8em;
        }

        .calendar-nav {
            display: flex;
            gap: 10px;
        }

        .calendar-nav button {
            padding: 10px 20px;
            border: none;
            background: #667eea;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .calendar-grid {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin-bottom: 2px;
        }

        .calendar-day-header {
            text-align: center;
            padding: 10px;
            font-weight: 700;
            color: #64748b;
            font-size: 0.9em;
        }

        .calendar-cells {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
        }

        .calendar-cell {
            aspect-ratio: 1;
            border: 1px solid #e2e8f0;
            padding: 8px;
            position: relative;
            background: white;
            min-height: 100px;
        }

        .calendar-cell.empty {
            background: #f8fafc;
        }

        .calendar-cell.today {
            background: #eff6ff;
            border: 2px solid #3b82f6;
        }

        .day-number {
            font-weight: 700;
            color: #1e293b;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        .calendar-activity {
            font-size: 0.7em;
            padding: 3px 6px;
            border-radius: 4px;
            margin-bottom: 3px;
            cursor: pointer;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 600;
        }

        .calendar-legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        /* List View */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: white;
            padding: 20px;
            border-radius: 15px;
        }

        .filters select {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
        }

        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .activity-item {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 5px solid;
        }

        .activity-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .activity-title {
            font-size: 1.2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .activity-meta {
            color: #64748b;
            font-size: 0.9em;
        }

        .activity-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #1e293b;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-add {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 18px 30px;
            border-radius: 15px;
            background: #667eea;
            color: white;
            border: none;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-add:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.6);
            background: #5568d3;
        }

        .btn-add-icon {
            font-size: 1.5em;
            line-height: 1;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-header h2 {
            font-size: 1.8em;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #64748b;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1e293b;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .radio-option input[type="radio"] {
            width: auto;
        }

        .area-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .area-option {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s;
        }

        .area-option:hover {
            border-color: #667eea;
        }

        .area-option.selected {
            border-color: #667eea;
            background: #eff6ff;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-pendiente {
            background: #fef3c7;
            color: #92400e;
        }

        .status-en-curso {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-realizada {
            background: #d1fae5;
            color: #065f46;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .calendar-cell {
                min-height: 80px;
                padding: 5px;
            }

            .activity-header {
                flex-direction: column;
                gap: 10px;
            }

            .modal-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1>üè• GTM 2025-27</h1>
            <p>Grupo de Terapia Manual</p>
            <select id="userSelect">
                <option value="">¬øQui√©n sos?</option>
                <option value="Presidente">Presidente</option>
                <option value="Vicepresidente">Vicepresidente</option>
                <option value="Secretario">Secretario/a</option>
                <option value="Nino">Nino (Prensa)</option>
                <option value="Bianca">Bianca (Prensa)</option>
                <option value="Eli">Eli (Prensa)</option>
                <option value="Ale">Ale (RRNN)</option>
                <option value="Fer">Fer (RRNN)</option>
                <option value="Martina">Martina (RRNN)</option>
                <option value="Selva">Selva (RRNN)</option>
                <option value="Diego">Diego (Movimiento)</option>
                <option value="Berni">Berni (Movimiento)</option>
                <option value="Carlos">Carlos (Movimiento)</option>
                <option value="Ceci">Ceci (Movimiento)</option>
                <option value="Charly">Charly (Cient√≠fico)</option>
                <option value="Silvina">Silvina (Cient√≠fico)</option>
                <option value="Lautaro">Lautaro (Cient√≠fico)</option>
                <option value="Javi">Javi (Cient√≠fico)</option>
                <option value="Mariana">Mariana (Cient√≠fico)</option>
            </select>
            <button onclick="login()">Entrar</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <header>
            <div class="header-content">
                <div class="logo">üè• GTM 2025-27</div>
                <div class="user-info">
                    <span class="user-badge" id="currentUser"></span>
                    <button class="logout-btn" onclick="logout()">Salir</button>
                </div>
            </div>
        </header>

        <div class="container">
            <nav class="nav-tabs">
                <button class="active" onclick="showView('dashboard')">üìä Dashboard</button>
                <button onclick="showView('calendar')">üìÖ Calendario</button>
                <button onclick="showView('list')">üìã Lista</button>
            </nav>

            <!-- Dashboard View -->
            <div id="dashboardView">
                <!-- Bot√≥n agregar en dashboard para usuarios con permisos -->
                <div id="dashboardAddButton" class="hidden" style="margin-bottom: 20px;">
                    <button onclick="openModal()" style="padding: 15px 30px; background: #667eea; color: white; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(102,126,234,0.3); display: flex; align-items: center; gap: 10px; transition: all 0.3s;">
                        <span style="font-size: 1.5em;">+</span>
                        <span>Crear Nueva Actividad</span>
                    </button>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <h3>üìÖ Pr√≥ximas Actividades</h3>
                        <div id="upcomingActivities"></div>
                    </div>
                    <div class="card">
                        <h3>üìä Estado por √Årea</h3>
                        <div id="areaProgress"></div>
                    </div>
                </div>
            </div>

            <!-- Calendar View -->
            <div id="calendarView" class="hidden">
                <div class="calendar-header">
                    <h2 id="calendarMonth"></h2>
                    <div class="calendar-nav">
                        <button onclick="changeMonth(-1)">‚Üê Anterior</button>
                        <button onclick="changeMonth(1)">Siguiente ‚Üí</button>
                    </div>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-days">
                        <div class="calendar-day-header">LUN</div>
                        <div class="calendar-day-header">MAR</div>
                        <div class="calendar-day-header">MI√â</div>
                        <div class="calendar-day-header">JUE</div>
                        <div class="calendar-day-header">VIE</div>
                        <div class="calendar-day-header">S√ÅB</div>
                        <div class="calendar-day-header">DOM</div>
                    </div>
                    <div class="calendar-cells" id="calendarCells"></div>
                </div>
                <div class="calendar-legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #9333ea;"></div>
                        <span>üì¢ Prensa y Difusi√≥n</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #3b82f6;"></div>
                        <span>üåç RRNN y RRII</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #22c55e;"></div>
                        <span>üìà Movimiento</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f97316;"></div>
                        <span>üéì Cient√≠fico y Acad√©mico</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #64748b;"></div>
                        <span>üèõÔ∏è Comisi√≥n Directiva</span>
                    </div>
                </div>
            </div>

            <!-- List View -->
            <div id="listView" class="hidden">
                <!-- Bot√≥n agregar en lista para usuarios con permisos -->
                <div id="listAddButton" class="hidden" style="margin-bottom: 20px;">
                    <button onclick="openModal()" style="padding: 15px 30px; background: #667eea; color: white; border: none; border-radius: 12px; font-size: 1.1em; font-weight: 700; cursor: pointer; box-shadow: 0 4px 15px rgba(102,126,234,0.3); display: flex; align-items: center; gap: 10px; transition: all 0.3s;">
                        <span style="font-size: 1.5em;">+</span>
                        <span>Crear Nueva Actividad</span>
                    </button>
                </div>
                
                <div class="filters">
                    <select id="filterArea" onchange="renderList()">
                        <option value="">Todas las √°reas</option>
                        <option value="prensa">Prensa y Difusi√≥n</option>
                        <option value="rrnn">RRNN y RRII</option>
                        <option value="movimiento">Movimiento</option>
                        <option value="cientifico">Cient√≠fico y Acad√©mico</option>
                        <option value="cd">Comisi√≥n Directiva</option>
                    </select>
                    <select id="filterStatus" onchange="renderList()">
                        <option value="">Todos los estados</option>
                        <option value="pendiente">Pendiente</option>
                        <option value="en-curso">En curso</option>
                        <option value="realizada">Realizada</option>
                    </select>
                </div>
                <div class="activity-list" id="activityList"></div>
            </div>
        </div>

        <!-- Add Button -->
        <button class="btn-add hidden" id="addButton" onclick="openModal()">
            <span class="btn-add-icon">+</span>
            <span>Nueva Actividad</span>
        </button>
    </div>

    <!-- Modal -->
    <div id="activityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Nueva Actividad</h2>
                <button class="close-modal" onclick="closeModal()">√ó</button>
            </div>
            <form id="activityForm" onsubmit="saveActivity(event)">
                <input type="hidden" id="activityId">
                
                <div class="form-group">
                    <label>T√≠tulo *</label>
                    <input type="text" id="activityTitle" required>
                </div>

                <div class="form-group">
                    <label>√Årea *</label>
                    <div class="area-selector" id="areaSelector"></div>
                </div>

                <div class="form-group">
                    <label>Responsable *</label>
                    <select id="activityResponsible" required></select>
                </div>

                <div class="form-group">
                    <label>Fecha *</label>
                    <input type="date" id="activityDate" required>
                </div>

                <div class="form-group">
                    <label>Hora</label>
                    <input type="time" id="activityTime" value="10:00">
                </div>

                <div class="form-group">
                    <label>Tipo *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="activityType" value="reunion_presencial" checked>
                            Reuni√≥n presencial
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="activityType" value="reunion_zoom">
                            Reuni√≥n Zoom
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="activityType" value="actividad">
                            Actividad
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="activityType" value="formacion">
                            Formaci√≥n
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="activityType" value="publicacion">
                            Publicaci√≥n
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Lugar / Link de Zoom</label>
                    <input type="text" id="activityLocation">
                </div>

                <div class="form-group">
                    <label>Estado *</label>
                    <select id="activityStatus" required>
                        <option value="pendiente">Pendiente</option>
                        <option value="en-curso">En curso</option>
                        <option value="realizada">Realizada</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Notas</label>
                    <textarea id="activityNotes"></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 15px; font-size: 1.1em;">
                    Guardar Actividad
                </button>
            </form>
        </div>
    </div>

    <script>
        const AREAS = {
            prensa: {
                nombre: "Prensa y Difusi√≥n",
                color: "#9333ea",
                emoji: "üì¢",
                miembros: ["Nino", "Bianca", "Eli"]
            },
            rrnn: {
                nombre: "RRNN y RRII",
                color: "#3b82f6",
                emoji: "üåç",
                miembros: ["Ale", "Fer", "Martina", "Selva"]
            },
            movimiento: {
                nombre: "Movimiento",
                color: "#22c55e",
                emoji: "üìà",
                miembros: ["Diego", "Berni", "Carlos", "Ceci"]
            },
            cientifico: {
                nombre: "Cient√≠fico y Acad√©mico",
                color: "#f97316",
                emoji: "üéì",
                miembros: ["Charly", "Silvina", "Lautaro", "Javi", "Mariana"]
            },
            cd: {
                nombre: "Comisi√≥n Directiva",
                color: "#64748b",
                emoji: "üèõÔ∏è",
                miembros: ["Presidente", "Vicepresidente", "Secretario"]
            }
        };

        const PERMISOS_EDITAR = [
            "Presidente", "Vicepresidente", "Secretario",
            "Nino", "Ale", "Ceci", "Silvina"
        ];

        let currentUser = null;
        let activities = [];
        let currentMonth = new Date();

        // Initialize
        async function init() {
            await loadActivities();
        }

        // Login
        function login() {
            const select = document.getElementById('userSelect');
            const user = select.value;
            
            if (!user) {
                alert('Por favor seleccion√° tu nombre');
                return;
            }

            currentUser = user;
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('currentUser').textContent = user;

            if (PERMISOS_EDITAR.includes(user)) {
                document.getElementById('addButton').classList.remove('hidden');
                document.getElementById('dashboardAddButton').classList.remove('hidden');
                document.getElementById('listAddButton').classList.remove('hidden');
            }

            init();
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('userSelect').value = '';
        }

        // Data Management - Usando JSONBin.io para almacenamiento compartido
        const JSONBIN_BIN_ID = '694b3cebd0ea881f403cce72'; // ID del contenedor compartido
        const JSONBIN_API_KEY = '$2a$10$lj1BXyzr7wtKMdj3A1JDlOX7W7sCdNZAK25hQw3yF.EOoOSLxBqNC'; // API Key

        async function loadActivities() {
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': JSONBIN_API_KEY
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    activities = data.record.activities || [];
                    console.log('Actividades cargadas:', activities.length);
                } else {
                    console.log('No hay actividades previas');
                }
            } catch (error) {
                console.log('Usando datos locales');
                const local = localStorage.getItem('gtm-activities-backup');
                if (local) {
                    activities = JSON.parse(local);
                }
            }
            renderAll();
        }

        async function saveActivities() {
            // Guardar en JSONBin (compartido)
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': JSONBIN_API_KEY
                    },
                    body: JSON.stringify({
                        activities: activities,
                        lastUpdate: new Date().toISOString(),
                        updatedBy: currentUser
                    })
                });
                
                if (response.ok) {
                    console.log('‚úÖ Datos guardados y sincronizados');
                }
            } catch (error) {
                console.error('Error al sincronizar:', error);
            }
            
            // Backup local
            localStorage.setItem('gtm-activities-backup', JSON.stringify(activities));
        }

        // View Management
        function showView(view) {
            document.querySelectorAll('.nav-tabs button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            document.getElementById('dashboardView').classList.add('hidden');
            document.getElementById('calendarView').classList.add('hidden');
            document.getElementById('listView').classList.add('hidden');

            if (view === 'dashboard') {
                document.getElementById('dashboardView').classList.remove('hidden');
                renderDashboard();
            } else if (view === 'calendar') {
                document.getElementById('calendarView').classList.remove('hidden');
                renderCalendar();
            } else if (view === 'list') {
                document.getElementById('listView').classList.remove('hidden');
                renderList();
            }
        }

        function renderAll() {
            renderDashboard();
            renderCalendar();
            renderList();
        }

        // Dashboard
        function renderDashboard() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const nextWeek = new Date(today);
            nextWeek.setDate(nextWeek.getDate() + 7);

            const upcoming = activities
                .filter(a => {
                    const actDate = new Date(a.fecha);
                    return actDate >= today && actDate <= nextWeek && a.estado !== 'realizada';
                })
                .sort((a, b) => new Date(a.fecha) - new Date(b.fecha))
                .slice(0, 5);

            const upcomingHTML = upcoming.length > 0
                ? upcoming.map(a => {
                    const area = AREAS[a.area];
                    return `
                        <div class="upcoming-activity" style="border-left-color: ${area.color}">
                            <strong>${area.emoji} ${a.titulo}</strong>
                            <small>${a.responsable} ‚Ä¢ ${formatDate(a.fecha)} ${a.hora}</small>
                        </div>
                    `;
                }).join('')
                : '<p style="color: #64748b; text-align: center;">No hay actividades pr√≥ximas</p>';

            document.getElementById('upcomingActivities').innerHTML = upcomingHTML;

            // Area Progress
            const progressHTML = Object.keys(AREAS).map(key => {
                const area = AREAS[key];
                const areaTasks = activities.filter(a => a.area === key);
                const completed = areaTasks.filter(a => a.estado === 'realizada').length;
                const percentage = areaTasks.length > 0 ? Math.round((completed / areaTasks.length) * 100) : 0;

                return `
                    <div class="area-progress">
                        <div class="area-label">
                            <span>${area.emoji} ${area.nombre}</span>
                            <span>${percentage}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percentage}%; background: ${area.color};"></div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('areaProgress').innerHTML = progressHTML;
        }

        // Calendar
        function renderCalendar() {
            const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
            
            document.getElementById('calendarMonth').textContent = 
                `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;

            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            
            let dayOfWeek = firstDay.getDay();
            dayOfWeek = dayOfWeek === 0 ? 6 : dayOfWeek - 1;

            const today = new Date();
            today.setHours(0, 0, 0, 0);

            let html = '';

            for (let i = 0; i < dayOfWeek; i++) {
                html += '<div class="calendar-cell empty"></div>';
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const currentDate = new Date(year, month, day);
                const dateStr = currentDate.toISOString().split('T')[0];
                const dayActivities = activities.filter(a => a.fecha === dateStr);

                const isToday = currentDate.getTime() === today.getTime();
                const todayClass = isToday ? 'today' : '';

                html += `
                    <div class="calendar-cell ${todayClass}">
                        <div class="day-number">${day}</div>
                        ${dayActivities.map(a => {
                            const area = AREAS[a.area];
                            return `
                                <div class="calendar-activity" 
                                     style="background: ${area.color}; color: white;"
                                     onclick="viewActivity('${a.id}')"
                                     title="${a.titulo}">
                                    ${area.emoji} ${a.titulo.substring(0, 15)}${a.titulo.length > 15 ? '...' : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }

            document.getElementById('calendarCells').innerHTML = html;
        }

        function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            renderCalendar();
        }

        // List View
        function renderList() {
            const filterArea = document.getElementById('filterArea').value;
            const filterStatus = document.getElementById('filterStatus').value;

            let filtered = activities;

            if (filterArea) {
                filtered = filtered.filter(a => a.area === filterArea);
            }

            if (filterStatus) {
                filtered = filtered.filter(a => a.estado === filterStatus);
            }

            filtered.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));

            const html = filtered.length > 0
                ? filtered.map(a => {
                    const area = AREAS[a.area];
                    const canEdit = PERMISOS_EDITAR.includes(currentUser);
                    
                    return `
                        <div class="activity-item" style="border-left-color: ${area.color}">
                            <div class="activity-header">
                                <div>
                                    <div class="activity-title">${area.emoji} ${a.titulo}</div>
                                    <div class="activity-meta">
                                        ${a.responsable} ‚Ä¢ ${formatDate(a.fecha)} ${a.hora} ‚Ä¢ 
                                        <span class="status-badge status-${a.estado}">${getStatusLabel(a.estado)}</span>
                                    </div>
                                    ${a.ubicacion ? `<div class="activity-meta">üìç ${a.ubicacion}</div>` : ''}
                                    ${a.notas ? `<div class="activity-meta" style="margin-top: 8px;">${a.notas}</div>` : ''}
                                </div>
                                ${canEdit ? `
                                    <div class="activity-actions">
                                        <button class="btn btn-secondary" onclick="editActivity('${a.id}')">Editar</button>
                                        <button class="btn btn-danger" onclick="deleteActivity('${a.id}')">Eliminar</button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('')
                : '<p style="text-align: center; color: #64748b; padding: 40px;">No hay actividades que mostrar</p>';

            document.getElementById('activityList').innerHTML = html;
        }

        // Modal
        function openModal(activityId = null) {
            renderAreaSelector();
            
            if (activityId) {
                const activity = activities.find(a => a.id === activityId);
                if (activity) {
                    document.getElementById('modalTitle').textContent = 'Editar Actividad';
                    document.getElementById('activityId').value = activity.id;
                    document.getElementById('activityTitle').value = activity.titulo;
                    selectArea(activity.area);
                    updateResponsibleOptions(activity.area, activity.responsable);
                    document.getElementById('activityDate').value = activity.fecha;
                    document.getElementById('activityTime').value = activity.hora;
                    document.querySelector(`input[name="activityType"][value="${activity.tipo}"]`).checked = true;
                    document.getElementById('activityLocation').value = activity.ubicacion || '';
                    document.getElementById('activityStatus').value = activity.estado;
                    document.getElementById('activityNotes').value = activity.notas || '';
                }
            } else {
                document.getElementById('modalTitle').textContent = 'Nueva Actividad';
                document.getElementById('activityForm').reset();
                document.getElementById('activityId').value = '';
                selectArea('prensa');
            }

            document.getElementById('activityModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('activityModal').classList.remove('active');
        }

        function renderAreaSelector() {
            const html = Object.keys(AREAS).map(key => {
                const area = AREAS[key];
                return `
                    <div class="area-option" data-area="${key}" onclick="selectArea('${key}')">
                        ${area.emoji}<br>${area.nombre}
                    </div>
                `;
            }).join('');
            document.getElementById('areaSelector').innerHTML = html;
        }

        function selectArea(areaKey) {
            document.querySelectorAll('.area-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            document.querySelector(`[data-area="${areaKey}"]`).classList.add('selected');
            updateResponsibleOptions(areaKey);
        }

        function updateResponsibleOptions(areaKey, selectedValue = null) {
            const area = AREAS[areaKey];
            const select = document.getElementById('activityResponsible');
            select.innerHTML = area.miembros.map(m => 
                `<option value="${m}" ${m === selectedValue ? 'selected' : ''}>${m}</option>`
            ).join('');
        }

        function saveActivity(event) {
            event.preventDefault();

            const selectedArea = document.querySelector('.area-option.selected');
            if (!selectedArea) {
                alert('Por favor seleccion√° un √°rea');
                return;
            }

            const id = document.getElementById('activityId').value || Date.now().toString();
            const activity = {
                id: id,
                titulo: document.getElementById('activityTitle').value,
                area: selectedArea.dataset.area,
                responsable: document.getElementById('activityResponsible').value,
                fecha: document.getElementById('activityDate').value,
                hora: document.getElementById('activityTime').value,
                tipo: document.querySelector('input[name="activityType"]:checked').value,
                ubicacion: document.getElementById('activityLocation').value,
                estado: document.getElementById('activityStatus').value,
                notas: document.getElementById('activityNotes').value,
                creadoPor: currentUser,
                creadoEl: new Date().toISOString()
            };

            const index = activities.findIndex(a => a.id === id);
            if (index >= 0) {
                activities[index] = activity;
            } else {
                activities.push(activity);
            }

            saveActivities();
            closeModal();
            renderAll();
        }

        function editActivity(id) {
            openModal(id);
        }

        function viewActivity(id) {
            const canEdit = PERMISOS_EDITAR.includes(currentUser);
            if (canEdit) {
                editActivity(id);
            }
        }

        function deleteActivity(id) {
            if (confirm('¬øEst√°s seguro/a de eliminar esta actividad?')) {
                activities = activities.filter(a => a.id !== id);
                saveActivities();
                renderAll();
            }
        }

        // Helper Functions
        function formatDate(dateStr) {
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('es-AR', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric' 
            });
        }

        function getStatusLabel(status) {
            const labels = {
                'pendiente': 'Pendiente',
                'en-curso': 'En curso',
                'realizada': 'Realizada'
            };
            return labels[status] || status;
        }

        // Close modal on outside click
        document.getElementById('activityModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>
